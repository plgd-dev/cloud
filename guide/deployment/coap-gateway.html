<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CoAP Gateway | plgd</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Secure and Interoperable Internet of Things">
    
    <link rel="preload" href="/assets/css/0.styles.6d18922d.css" as="style"><link rel="preload" href="/assets/js/app.361603d2.js" as="script"><link rel="preload" href="/assets/js/2.e0060528.js" as="script"><link rel="preload" href="/assets/js/17.36bcb6ca.js" as="script"><link rel="prefetch" href="/assets/js/10.e2ff43d9.js"><link rel="prefetch" href="/assets/js/11.2fb98707.js"><link rel="prefetch" href="/assets/js/12.3ac77ce7.js"><link rel="prefetch" href="/assets/js/13.b9941d96.js"><link rel="prefetch" href="/assets/js/14.9ba9e313.js"><link rel="prefetch" href="/assets/js/15.fae284a4.js"><link rel="prefetch" href="/assets/js/16.6af34eb9.js"><link rel="prefetch" href="/assets/js/18.1b492466.js"><link rel="prefetch" href="/assets/js/19.e2408cf2.js"><link rel="prefetch" href="/assets/js/20.bdf42c62.js"><link rel="prefetch" href="/assets/js/21.b8cdc876.js"><link rel="prefetch" href="/assets/js/22.7b9d62cb.js"><link rel="prefetch" href="/assets/js/23.3616b3be.js"><link rel="prefetch" href="/assets/js/24.3c36a4e8.js"><link rel="prefetch" href="/assets/js/25.8c14d9fe.js"><link rel="prefetch" href="/assets/js/26.54aef082.js"><link rel="prefetch" href="/assets/js/27.07ab084e.js"><link rel="prefetch" href="/assets/js/28.4599805b.js"><link rel="prefetch" href="/assets/js/29.4e859b9d.js"><link rel="prefetch" href="/assets/js/3.ea5d28bc.js"><link rel="prefetch" href="/assets/js/4.a40a2fc0.js"><link rel="prefetch" href="/assets/js/5.4d493bce.js"><link rel="prefetch" href="/assets/js/6.6d64bc1f.js"><link rel="prefetch" href="/assets/js/7.d405cf6f.js"><link rel="prefetch" href="/assets/js/8.0ce0d58d.js"><link rel="prefetch" href="/assets/js/9.6b51459b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6d18922d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo-long.svg" alt="plgd" class="logo"> <span class="site-name can-hide">plgd</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://gitter.im/ocfcloud/Lobby" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat with us
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/plgd-dev/cloud/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/plgd-dev/cloud" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://gitter.im/ocfcloud/Lobby" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat with us
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/plgd-dev/cloud/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/plgd-dev/cloud" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/deployment/authorization-server.html" class="sidebar-link">Authorization Server</a></li><li><a href="/guide/deployment/resource-aggregate.html" class="sidebar-link">Resource Aggregate</a></li><li><a href="/guide/deployment/resource-directory.html" class="sidebar-link">Resource Directory</a></li><li><a href="/guide/deployment/coap-gateway.html" aria-current="page" class="active sidebar-link">CoAP Gateway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/deployment/coap-gateway.html#docker-image" class="sidebar-link">Docker Image</a></li><li class="sidebar-sub-header"><a href="/guide/deployment/coap-gateway.html#docker-run" class="sidebar-link">Docker Run</a></li><li class="sidebar-sub-header"><a href="/guide/deployment/coap-gateway.html#yaml-configuration" class="sidebar-link">YAML Configuration</a></li></ul></li><li><a href="/guide/deployment/cloud2cloud-connector.html" class="sidebar-link">Cloud2Cloud connector</a></li><li><a href="/guide/deployment/cloud2cloud-gateway.html" class="sidebar-link">Cloud2Cloud Gateway</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Developing with plgd</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="coap-gateway"><a href="#coap-gateway" class="header-anchor">#</a> CoAP Gateway</h1> <p>CoAP Gateway provides API for devices and clients following the <a href="https://openconnectivity.org/" target="_blank" rel="noopener noreferrer">Open Connectivity Foundation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> specification.</p> <h2 id="docker-image"><a href="#docker-image" class="header-anchor">#</a> Docker Image</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>docker pull plgd/coap-gateway:latest
</code></pre></div><h2 id="docker-run"><a href="#docker-run" class="header-anchor">#</a> Docker Run</h2> <h3 id="how-to-make-certificates"><a href="#how-to-make-certificates" class="header-anchor">#</a> How to make certificates</h3> <p>Before you run docker image of plgd/coap-gateway, you make sure certificates exists on <code>.tmp/certs</code> folder.<br>
If not exists, you can create certificates from plgd/bundle image by following step only once.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Create local folder for certificates and run plgd/bundle image to execute shell. </span>
<span class="token function">mkdir</span> -p <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>.tmp/certs
docker run -it <span class="token punctuation">\</span>
	--network<span class="token operator">=</span>host <span class="token punctuation">\</span>
	-v <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/.tmp/certs:/certs <span class="token punctuation">\</span>
	-e <span class="token assign-left variable">CLOUD_SID</span><span class="token operator">=</span>00000000-0000-0000-0000-000000000001 <span class="token punctuation">\</span>
	--entrypoint /bin/bash <span class="token punctuation">\</span>
	plgd/bundle:latest   

<span class="token comment"># Copy &amp; paste below commands on the bash shell of plgd/bundle container.</span>
certificate-generator --cmd.generateRootCA --outCert<span class="token operator">=</span>/certs/root_ca.crt --outKey<span class="token operator">=</span>/certs/root_ca.key --cert.subject.cn<span class="token operator">=</span>RootCA 
certificate-generator --cmd.generateCertificate --outCert<span class="token operator">=</span>/certs/http.crt --outKey<span class="token operator">=</span>/certs/http.key --cert.subject.cn<span class="token operator">=</span>localhost --cert.san.domain<span class="token operator">=</span>localhost --signerCert<span class="token operator">=</span>/certs/root_ca.crt --signerKey<span class="token operator">=</span>/certs/root_ca.key
certificate-generator --cmd.generateIdentityCertificate<span class="token operator">=</span><span class="token variable">$CLOUD_SID</span> --outCert<span class="token operator">=</span>/certs/coap.crt --outKey<span class="token operator">=</span>/certs/coap.key --cert.san.domain<span class="token operator">=</span>localhost --signerCert<span class="token operator">=</span>/certs/root_ca.crt --signerKey<span class="token operator">=</span>/certs/root_ca.key

<span class="token comment"># Exit shell.</span>
<span class="token builtin class-name">exit</span> 
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># See common certificates for plgd cloud services.</span>
<span class="token function">ls</span> .tmp/certs
coap.crt	coap.key	http.crt	http.key	root_ca.crt	root_ca.key
</code></pre></div><h3 id="how-to-get-configuration-file"><a href="#how-to-get-configuration-file" class="header-anchor">#</a> How to get configuration file</h3> <p>A configuration template is available on <a href="https://github.com/plgd-dev/cloud/blob/v2/coap-gateway/config.yaml" target="_blank" rel="noopener noreferrer">coap-gateway/config.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.<br>
You can also see <code>config.yaml</code> configuration file on the <code>coap-gateway</code> folder by downloading <code>git clone https://github.com/plgd-dev/cloud.git</code>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Copy &amp; paste configuration template from the link and save the file named `coap-gateway.yaml` on the local folder.</span>
<span class="token function">vi</span> coap-gateway.yaml

<span class="token comment"># Or download configuration template.</span>
<span class="token function">curl</span> https://github.com/plgd-dev/cloud/blob/v2/coap-gateway/config.yaml --output coap-gateway.yaml 
</code></pre></div><h3 id="edit-configuration-file"><a href="#edit-configuration-file" class="header-anchor">#</a> Edit configuration file</h3> <p>You can edit configuration file including server port, certificates, OAuth provider and so on.<br>
Read more detail about how to configure OAuth Provider <a href="https://github.com/plgd-dev/cloud/blob/v2/docs/guide/developing/authorization.md#how-to-configure-auth0" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>See an example of address, tls and OAuth config on the followings.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">...</span>
<span class="token key atrule">apis</span><span class="token punctuation">:</span>
  <span class="token key atrule">coap</span><span class="token punctuation">:</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token string">&quot;0.0.0.0:5684&quot;</span>
    <span class="token key atrule">externalAddress</span><span class="token punctuation">:</span> <span class="token string">&quot;coap-gw.example.com:5684&quot;</span>
    <span class="token key atrule">tls</span><span class="token punctuation">:</span>
      <span class="token key atrule">caPool</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/root_ca.crt&quot;</span>
      <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/coap.key&quot;</span>
      <span class="token key atrule">certFile</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/coap.crt&quot;</span>
<span class="token punctuation">...</span>
<span class="token key atrule">clients</span><span class="token punctuation">:</span>
  <span class="token key atrule">eventBus</span><span class="token punctuation">:</span>
    <span class="token key atrule">nats</span><span class="token punctuation">:</span>
      <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">&quot;nats://localhost:4222&quot;</span>
      <span class="token key atrule">tls</span><span class="token punctuation">:</span>
        <span class="token key atrule">caPool</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/root_ca.crt&quot;</span>
        <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/http.key&quot;</span>
        <span class="token key atrule">certFile</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/http.crt&quot;</span>
<span class="token punctuation">...</span>
  <span class="token key atrule">authorizationServer</span><span class="token punctuation">:</span>
    <span class="token key atrule">grpc</span><span class="token punctuation">:</span>
      <span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token string">&quot;localhost:9081&quot;</span>
      <span class="token key atrule">tls</span><span class="token punctuation">:</span>
        <span class="token key atrule">caPool</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/root_ca.crt&quot;</span>
        <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/http.key&quot;</span>
        <span class="token key atrule">certFile</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/http.crt&quot;</span>
    <span class="token key atrule">oauth</span><span class="token punctuation">:</span>
      <span class="token key atrule">clientID</span><span class="token punctuation">:</span> <span class="token string">&quot;412dsFf53Sj6$&quot;</span>
      <span class="token key atrule">clientSecret</span><span class="token punctuation">:</span> <span class="token string">&quot;235Jgdf65jsd4Shls&quot;</span>
      <span class="token key atrule">scopes</span><span class="token punctuation">:</span> <span class="token string">&quot;openid&quot;</span>
      <span class="token key atrule">tokenURL</span><span class="token punctuation">:</span> <span class="token string">&quot;https://auth.example.com/oauth/token&quot;</span>
      <span class="token key atrule">audience</span><span class="token punctuation">:</span> <span class="token string">&quot;https://api.example.com&quot;</span>
<span class="token punctuation">...</span>
  <span class="token key atrule">resourceAggregate</span><span class="token punctuation">:</span>
    <span class="token key atrule">grpc</span><span class="token punctuation">:</span>
      <span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token string">&quot;localhost:9083&quot;</span>
      <span class="token key atrule">tls</span><span class="token punctuation">:</span>
        <span class="token key atrule">caPool</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/root_ca.crt&quot;</span>
        <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/http.key&quot;</span>
        <span class="token key atrule">certFile</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/http.crt&quot;</span>
<span class="token punctuation">...</span>
  <span class="token key atrule">resourceDirectory</span><span class="token punctuation">:</span>
    <span class="token key atrule">grpc</span><span class="token punctuation">:</span>
      <span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token string">&quot;localhost:9082&quot;</span>
      <span class="token key atrule">tls</span><span class="token punctuation">:</span>
        <span class="token key atrule">caPool</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/root_ca.crt&quot;</span>
        <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/http.key&quot;</span>
        <span class="token key atrule">certFile</span><span class="token punctuation">:</span> <span class="token string">&quot;/data/certs/http.crt&quot;</span>
<span class="token punctuation">...</span>
</code></pre></div><h3 id="run-docker-image"><a href="#run-docker-image" class="header-anchor">#</a> Run docker image</h3> <p>You can run plgd/coap-gateway image using certificates and configuration file on the folder you made certificates.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -d --network<span class="token operator">=</span>host <span class="token punctuation">\</span>
	--name<span class="token operator">=</span>coap-gateway <span class="token punctuation">\</span>
	-v <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/.tmp/certs:/data/certs <span class="token punctuation">\</span>
	-v <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/coap-gateway.yaml:/data/coap-gateway.yaml <span class="token punctuation">\</span>
	plgd/coap-gateway:latest --config<span class="token operator">=</span>/data/coap-gateway.yaml
</code></pre></div><h2 id="yaml-configuration"><a href="#yaml-configuration" class="header-anchor">#</a> YAML Configuration</h2> <h3 id="logging"><a href="#logging" class="header-anchor">#</a> Logging</h3> <table><thead><tr><th>Property</th> <th>Type</th> <th>Description</th> <th>Default</th></tr></thead> <tbody><tr><td><code>log.debug</code></td> <td>bool</td> <td><code>Set to true if you would like to see extra information on logs.</code></td> <td><code>false</code></td></tr> <tr><td><code>log.dumpCoapMessages</code></td> <td>bool</td> <td><code>Set to true if you would like to dump raw messages.</code></td> <td><code>false</code></td></tr></tbody></table> <h3 id="coap-api"><a href="#coap-api" class="header-anchor">#</a> CoAP API</h3> <p>CoAP API as specified in the <a href="https://openconnectivity.org/specs/OCF_Device_To_Cloud_Services_Specification_v2.2.3.pdf" target="_blank" rel="noopener noreferrer">Open Connectivity Foundation - Device to Cloud Services<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <table><thead><tr><th>Property</th> <th>Type</th> <th>Description</th> <th>Default</th></tr></thead> <tbody><tr><td><code>api.coap.address</code></td> <td>string</td> <td><code>Listen specification &lt;host&gt;:&lt;port&gt; for coap client connection.</code></td> <td><code>&quot;0.0.0.0:5684&quot;</code></td></tr> <tr><td><code>api.coap.externalAddress</code></td> <td>string</td> <td><code>External address including public domain/IP for coap client connection.</code></td> <td><code>&quot;coap-gw.example.com:5684&quot;</code></td></tr> <tr><td><code>api.coap.maxMessageSize</code></td> <td>int</td> <td><code>Max message size which can be send/receive via coap. i.e. 256*1024 = 262144 bytes.</code></td> <td><code>262144</code></td></tr> <tr><td><code>api.coap.goroutineSocketHeartbeat</code></td> <td>string</td> <td><code>Interval time to check live service.</code></td> <td><code>4s</code></td></tr> <tr><td><code>api.coap.keepAlive.timeout</code></td> <td>string</td> <td><code>Time limit to close inactive connection.</code></td> <td><code>20s</code></td></tr> <tr><td><code>api.coap.blockwiseTransfer.enabled</code></td> <td>bool</td> <td><code>If true, enable blockwise transfer of coap message.</code></td> <td><code>true</code></td></tr> <tr><td><code>api.coap.blockwiseTransfer.blockSize</code></td> <td>int</td> <td><code>Size of blockwise transfer block.</code></td> <td><code>1024</code></td></tr> <tr><td><code>api.coap.tls.enabled</code></td> <td>bool</td> <td><code>If true, require server certificate for ssl connection.</code></td> <td><code>true</code></td></tr> <tr><td><code>api.coap.tls.caPool</code></td> <td>string</td> <td><code>File path to the root certificate in PEM format which might contain multiple certificates in a single file.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>api.coap.tls.keyFile</code></td> <td>string</td> <td><code>File path to private key in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>api.coap.tls.certFile</code></td> <td>string</td> <td><code>File path to certificate in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>api.coap.tls.clientCertificateRequired</code></td> <td>bool</td> <td><code>If true, require client certificate.</code></td> <td><code>true</code></td></tr></tbody></table> <h3 id="event-bus"><a href="#event-bus" class="header-anchor">#</a> Event Bus</h3> <p>Plgd cloud uses NATS messaging system as a event bus.</p> <table><thead><tr><th>Property</th> <th>Type</th> <th>Description</th> <th>Default</th></tr></thead> <tbody><tr><td><code>clients.eventBus.goPoolSize</code></td> <td>int</td> <td><code>Number of routines to process events in projection.</code></td> <td><code>16</code></td></tr> <tr><td><code>clients.eventBus.nats.url</code></td> <td>string</td> <td><code>URL to nats messaging system.</code></td> <td><code>&quot;nats://localhost:4222&quot;</code></td></tr> <tr><td><code>clients.eventBus.nats.pendingLimits.msgLimit</code></td> <td>int</td> <td><code>Limit number of messages in queue. -1 means unlimited</code></td> <td><code>524288</code></td></tr> <tr><td><code>clients.eventBus.nats.pendingLimits.bytesLimit</code></td> <td>int</td> <td><code>Limit buffer size of queue. -1 means unlimited</code></td> <td><code>67108864</code></td></tr> <tr><td><code>clients.eventBus.nats.tls.caPool</code></td> <td>string</td> <td><code>root certificate the root certificate in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.eventBus.nats.tls.keyFile</code></td> <td>string</td> <td><code>File name of private key in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.eventBus.nats.tls.certFile</code></td> <td>string</td> <td><code>File name of certificate in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.eventBus.nats.tls.useSystemCAPool</code></td> <td>bool</td> <td><code>If true, use system certification pool.</code></td> <td><code>false</code></td></tr></tbody></table> <h3 id="authorization-server-client"><a href="#authorization-server-client" class="header-anchor">#</a> Authorization Server Client</h3> <p>Client configurations to internally connect to Authorization Server service.</p> <table><thead><tr><th>Property</th> <th>Type</th> <th>Description</th> <th>Default</th></tr></thead> <tbody><tr><td><code>clients.authorizationServer.pullFrequency</code></td> <td>string</td> <td><code>Frequency to pull changed user device.</code></td> <td><code>15s</code></td></tr> <tr><td><code>clients.authorizationServer.cacheExpiration</code></td> <td>string</td> <td><code>Expiration time of cached user device.</code></td> <td><code>1m</code></td></tr> <tr><td><code>clients.authorizationServer.ownerClaim</code></td> <td>string</td> <td><code>Claim used to identify owner of the device.</code></td> <td><code>&quot;sub&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.grpc.address</code></td> <td>string</td> <td><code>Authoriztion service address.</code></td> <td><code>&quot;127.0.0.1:9100&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.grpc.tls.caPool</code></td> <td>string</td> <td><code>File path to the root certificate in PEM format which might contain multiple certificates in a single file.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.grpc.tls.keyFile</code></td> <td>string</td> <td><code>File path to private key in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.grpc.tls.certFile</code></td> <td>string</td> <td><code>File path to certificate in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.grpc.tls.useSystemCAPool</code></td> <td>bool</td> <td><code>If true, use system certification pool.</code></td> <td><code>false</code></td></tr> <tr><td><code>clients.authorizationServer.grpc.keepAlive.time</code></td> <td>string</td> <td><code>After a duration of this time if the client doesn't see any activity it pings the server to see if the transport is still alive.</code></td> <td><code>10s</code></td></tr> <tr><td><code>clients.authorizationServer.grpc.keepAlive.timeout</code></td> <td>string</td> <td><code>After having pinged for keepalive check, the client waits for a duration of Timeout and if no activity is seen even after that the connection is closed.</code></td> <td><code>20s</code></td></tr> <tr><td><code>clients.authorizationServer.grpc.keepAlive.permitWithoutStream</code></td> <td>bool</td> <td><code>If true, client sends keepalive pings even with no active RPCs. If false, when there are no active RPCs, Time and Timeout will be ignored and no keepalive pings will be sent.</code></td> <td><code>false</code></td></tr></tbody></table> <h3 id="oauth2-0-service-client"><a href="#oauth2-0-service-client" class="header-anchor">#</a> OAuth2.0 Service Client</h3> <blockquote><p>Configured OAuth2.0 client is used by internal service to request a token used to authorize all calls they execute against other plgd APIs.</p></blockquote> <table><thead><tr><th>Property</th> <th>Type</th> <th>Description</th> <th>Default</th></tr></thead> <tbody><tr><td><code>clients.authorizationServer.oauth.clientID</code></td> <td>string</td> <td><code>Client ID to exchange an authorization code for an access token.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.clientSecret</code></td> <td>string</td> <td><code>Client secret to exchange an authorization code for an access token.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.scopes</code></td> <td>string</td> <td><code>Comma separated list of required scopes.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.tokenURL</code></td> <td>string</td> <td><code>Token endpoint of OAuth provider.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.audience</code></td> <td>string</td> <td><code>Identifier of the API configured in your OAuth provider.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.verifyServiceTokenFrequency</code></td> <td>string</td> <td><code>Frequency to verify service token.</code></td> <td><code>10s</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.http.maxIdleConns</code></td> <td>int</td> <td><code>It controls the maximum number of idle (keep-alive) connections across all hosts. Zero means no limit.</code></td> <td><code>16</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.http.maxConnsPerHost</code></td> <td>int</td> <td><code>It optionally limits the total number of connections per host, including connections in the dialing, active, and idle states. On limit violation, dials will block. Zero means no limit.</code></td> <td><code>32</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.http.maxIdleConnsPerHost</code></td> <td>int</td> <td><code>If non-zero, controls the maximum idle (keep-alive) connections to keep per-host. If zero, DefaultMaxIdleConnsPerHost is used.</code></td> <td><code>16</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.http.idleConnTimeout</code></td> <td>string</td> <td><code>The maximum amount of time an idle (keep-alive) connection will remain idle before closing itself. Zero means no limit.</code></td> <td><code>30s</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.http.timeout</code></td> <td>string</td> <td><code>A time limit for requests made by this Client. A Timeout of zero means no timeout.</code></td> <td><code>10s</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.http.tls.caPool</code></td> <td>string</td> <td><code>File path to the root certificate in PEM format which might contain multiple certificates in a single file.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.http.tls.keyFile</code></td> <td>string</td> <td><code>File path to private key in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.http.tls.certFile</code></td> <td>string</td> <td><code>File path to certificate in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.authorizationServer.oauth.http.tls.useSystemCAPool</code></td> <td>bool</td> <td><code>If true, use system certification pool.</code></td> <td><code>false</code></td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">Audience</p> <p>You might have one client, but multiple APIs in the OAuth system. What you want to prevent is to be able to contact all the APIs of your system with one token. This audience allows you to request the token for a specific API. If you configure it to myplgdc2c.api in the Auth0, you have to set it here if you want to also validate it.</p></div> <h3 id="resource-aggregate-client"><a href="#resource-aggregate-client" class="header-anchor">#</a> Resource Aggregate Client</h3> <p>Client configurations to internally connect to Resource Aggregate service.</p> <table><thead><tr><th>Property</th> <th>Type</th> <th>Description</th> <th>Default</th></tr></thead> <tbody><tr><td><code>clients.resourceAggregate.grpc.address</code></td> <td>string</td> <td><code>Resource aggregate service address.</code></td> <td><code>&quot;127.0.0.1:9100&quot;</code></td></tr> <tr><td><code>clients.resourceAggregate.grpc.tls.caPool</code></td> <td>string</td> <td><code>File path to the root certificate in PEM format which might contain multiple certificates in a single file.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.resourceAggregate.grpc.tls.keyFile</code></td> <td>string</td> <td><code>File path to private key in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.resourceAggregate.grpc.tls.certFile</code></td> <td>string</td> <td><code>File path to certificate in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.resourceAggregate.grpc.tls.useSystemCAPool</code></td> <td>bool</td> <td><code>If true, use system certification pool.</code></td> <td><code>false</code></td></tr> <tr><td><code>clients.resourceAggregate.grpc.keepAlive.time</code></td> <td>string</td> <td><code>After a duration of this time if the client doesn't see any activity it pings the server to see if the transport is still alive.</code></td> <td><code>10s</code></td></tr> <tr><td><code>clients.resourceAggregate.grpc.keepAlive.timeout</code></td> <td>string</td> <td><code>After having pinged for keepalive check, the client waits for a duration of Timeout and if no activity is seen even after that the connection is closed.</code></td> <td><code>20s</code></td></tr> <tr><td><code>clients.resourceAggregate.grpc.keepAlive.permitWithoutStream</code></td> <td>bool</td> <td><code>If true, client sends keepalive pings even with no active RPCs. If false, when there are no active RPCs, Time and Timeout will be ignored and no keepalive pings will be sent.</code></td> <td><code>false</code></td></tr> <tr><td><code>clients.resourceAggregate.deviceStatusExpiration.enabled</code></td> <td>bool</td> <td><code>If ture, refresh device online status in short time than sign token expires.</code></td> <td><code>false</code></td></tr> <tr><td><code>clients.resourceAggregate.deviceStatusExpiration.ExpiresIn</code></td> <td>bool</td> <td><code>Interval time to refresh device online status.</code></td> <td><code>24h</code></td></tr></tbody></table> <h3 id="resource-directory-client"><a href="#resource-directory-client" class="header-anchor">#</a> Resource Directory Client</h3> <p>Client configurations to internally connect to Resource Directory service.</p> <table><thead><tr><th>Property</th> <th>Type</th> <th>Description</th> <th>Default</th></tr></thead> <tbody><tr><td><code>clients.resourceDirectory.grpc.address</code></td> <td>string</td> <td><code>Resource directory service address.</code></td> <td><code>&quot;127.0.0.1:9100&quot;</code></td></tr> <tr><td><code>clients.resourceDirectory.grpc.tls.caPool</code></td> <td>string</td> <td><code>File path to the root certificate in PEM format which might contain multiple certificates in a single file.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.resourceDirectory.grpc.tls.keyFile</code></td> <td>string</td> <td><code>File path to private key in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.resourceDirectory.grpc.tls.certFile</code></td> <td>string</td> <td><code>File path to certificate in PEM format.</code></td> <td><code>&quot;&quot;</code></td></tr> <tr><td><code>clients.resourceDirectory.grpc.tls.useSystemCAPool</code></td> <td>bool</td> <td><code>If true, use system certification pool.</code></td> <td><code>false</code></td></tr> <tr><td><code>clients.resourceDirectory.grpc.keepAlive.time</code></td> <td>string</td> <td><code>After a duration of this time if the client doesn't see any activity it pings the server to see if the transport is still alive.</code></td> <td><code>10s</code></td></tr> <tr><td><code>clients.resourceDirectory.grpc.keepAlive.timeout</code></td> <td>string</td> <td><code>After having pinged for keepalive check, the client waits for a duration of Timeout and if no activity is seen even after that the connection is closed.</code></td> <td><code>20s</code></td></tr> <tr><td><code>clients.resourceDirectory.grpc.keepAlive.permitWithoutStream</code></td> <td>bool</td> <td><code>If true, client sends keepalive pings even with no active RPCs. If false, when there are no active RPCs, Time and Timeout will be ignored and no keepalive pings will be sent.</code></td> <td><code>false</code></td></tr></tbody></table> <h3 id="task-queue"><a href="#task-queue" class="header-anchor">#</a> Task Queue</h3> <table><thead><tr><th>Property</th> <th>Type</th> <th>Description</th> <th>Default</th></tr></thead> <tbody><tr><td><code>taskQueue.goPoolSize</code></td> <td>int</td> <td><code>Maximum number of running goroutine instances.</code></td> <td><code>1600</code></td></tr> <tr><td><code>taskQueue.size</code></td> <td>int</td> <td><code>Size of queue. If it exhausted, submit returns error.</code></td> <td><code>2097152</code></td></tr> <tr><td><code>taskQueue.maxIdleTime</code></td> <td>string</td> <td><code>Sets up the interval time of cleaning up goroutines. Zero means never cleanup.</code></td> <td><code>10m</code></td></tr></tbody></table> <blockquote><p>Note that the string type related to time (i.e. timeout, idleConnTimeout, expirationTime) is decimal numbers, each with optional fraction and a unit suffix, such as &quot;300ms&quot;, &quot;1.5h&quot; or &quot;2h45m&quot;. Valid time units are &quot;ns&quot;, &quot;us&quot;, &quot;ms&quot;, &quot;s&quot;, &quot;m&quot;, &quot;h&quot;.</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/plgd-dev/cloud/edit/v2/docs/guide/deployment/coap-gateway.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/10/2021, 11:19:33 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/deployment/resource-directory.html" class="prev">
        Resource Directory
      </a></span> <span class="next"><a href="/guide/deployment/cloud2cloud-connector.html">
        Cloud2Cloud connector
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.361603d2.js" defer></script><script src="/assets/js/2.e0060528.js" defer></script><script src="/assets/js/17.36bcb6ca.js" defer></script>
  </body>
</html>
