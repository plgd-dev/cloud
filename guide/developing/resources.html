<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Working with Resources | plgd</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Secure and Interoperable Internet of Things">
    
    <link rel="preload" href="/assets/css/0.styles.6d18922d.css" as="style"><link rel="preload" href="/assets/js/app.046fd415.js" as="script"><link rel="preload" href="/assets/js/2.7dba4fe4.js" as="script"><link rel="preload" href="/assets/js/26.de82e42f.js" as="script"><link rel="prefetch" href="/assets/js/10.60c8ae2a.js"><link rel="prefetch" href="/assets/js/11.5d71b7ed.js"><link rel="prefetch" href="/assets/js/12.75db3687.js"><link rel="prefetch" href="/assets/js/13.bf06e2f6.js"><link rel="prefetch" href="/assets/js/14.89b9e1ef.js"><link rel="prefetch" href="/assets/js/15.ca5fcbd2.js"><link rel="prefetch" href="/assets/js/16.cb486e08.js"><link rel="prefetch" href="/assets/js/17.c91e8435.js"><link rel="prefetch" href="/assets/js/18.99eaa75f.js"><link rel="prefetch" href="/assets/js/19.67f6887a.js"><link rel="prefetch" href="/assets/js/20.0d60ec71.js"><link rel="prefetch" href="/assets/js/21.69636599.js"><link rel="prefetch" href="/assets/js/22.92a525a5.js"><link rel="prefetch" href="/assets/js/23.c0bb2db7.js"><link rel="prefetch" href="/assets/js/24.8cd274a2.js"><link rel="prefetch" href="/assets/js/25.7560774e.js"><link rel="prefetch" href="/assets/js/27.1ffee52b.js"><link rel="prefetch" href="/assets/js/28.1a420876.js"><link rel="prefetch" href="/assets/js/29.a191a2ba.js"><link rel="prefetch" href="/assets/js/3.b37a7ff9.js"><link rel="prefetch" href="/assets/js/4.4a6ec60c.js"><link rel="prefetch" href="/assets/js/5.7d769631.js"><link rel="prefetch" href="/assets/js/6.dd352acd.js"><link rel="prefetch" href="/assets/js/7.46ab0cc2.js"><link rel="prefetch" href="/assets/js/8.fec00c5e.js"><link rel="prefetch" href="/assets/js/9.be0aa687.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6d18922d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo-long.svg" alt="plgd" class="logo"> <span class="site-name can-hide">plgd</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://gitter.im/ocfcloud/Lobby" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat with us
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/plgd-dev/cloud/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/plgd-dev/cloud" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://gitter.im/ocfcloud/Lobby" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat with us
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/plgd-dev/cloud/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Changelog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/plgd-dev/cloud" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Architecture</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Developing with plgd</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/developing/resources.html" aria-current="page" class="active sidebar-link">Working with Resources</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/developing/resources.html#creating-resources" class="sidebar-link">Creating Resources</a></li><li class="sidebar-sub-header"><a href="/guide/developing/resources.html#deleting-resources" class="sidebar-link">Deleting Resources</a></li></ul></li><li><a href="/guide/developing/dashboard.html" class="sidebar-link">PLGD Dashboard</a></li><li><a href="/guide/developing/authorization.html" class="sidebar-link">Authorization</a></li><li><a href="/guide/developing/grpc-client.html" class="sidebar-link">Working with GRPC Client</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="working-with-resources"><a href="#working-with-resources" class="header-anchor">#</a> Working with Resources</h1> <h2 id="creating-resources"><a href="#creating-resources" class="header-anchor">#</a> Creating Resources</h2> <h3 id="description"><a href="#description" class="header-anchor">#</a> Description</h3> <p>Device with collection resource allows dynamic creation of resources. The created resource can only be of a well defined type (see call to <code>oc_collections_add_rt_factory</code> in <a href="#define-constructor-and-destructor">Guide</a>) and all created resources are contained within the collection.</p> <h3 id="guide"><a href="#guide" class="header-anchor">#</a> Guide</h3> <p>To develop your own device you can examine the example in <a href="https://github.com/iotivity/iotivity-lite/blob/master/apps/cloud_server.c" target="_blank" rel="noopener noreferrer">cloud_server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Lets examine the example to identify the necessary steps that allow a device to dynamically create resources on a collection.</p> <h4 id="create-a-collection-resource"><a href="#create-a-collection-resource" class="header-anchor">#</a> Create a collection resource</h4> <div class="language-C extra-class"><pre class="language-c"><code><span class="token class-name">oc_resource_t</span><span class="token operator">*</span> col <span class="token operator">=</span> <span class="token function">oc_new_collection</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">&quot;/switches&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">oc_resource_bind_resource_type</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token string">&quot;oic.wk.col&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For precise description of arguments of given functions please refer to the iotivity-lite documentation.</p> <h4 id="determine-which-resource-types-can-populate-the-collection"><a href="#determine-which-resource-types-can-populate-the-collection" class="header-anchor">#</a> Determine which resource types can populate the collection</h4> <div class="language-C extra-class"><pre class="language-c"><code><span class="token function">oc_collection_add_supported_rt</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token string">&quot;oic.r.switch.binary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Supported resource types are visible through <code>oic.if.baseline</code> interface in a property <code>rts</code> of the collection.</p> <h4 id="enable-create-operation-on-the-collection-resource"><a href="#enable-create-operation-on-the-collection-resource" class="header-anchor">#</a> Enable create operation on the collection resource</h4> <div class="language-C extra-class"><pre class="language-c"><code><span class="token function">oc_resource_bind_resource_interface</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> OC_IF_CREATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Supporting creating resource is visible through <code>oic.if.baseline</code> interface in a property <code>if</code> of the collection. The property must contains <code>oic.if.create</code> interface.</p> <h4 id="define-constructor-and-destructor"><a href="#define-constructor-and-destructor" class="header-anchor">#</a> Define constructor and destructor</h4> <div class="language-C extra-class"><pre class="language-c"><code><span class="token function">oc_collections_add_rt_factory</span><span class="token punctuation">(</span><span class="token string">&quot;oic.r.switch.binary&quot;</span><span class="token punctuation">,</span> new_switch_instance<span class="token punctuation">,</span> free_switch_instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-C extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">oc_switch_t</span>
<span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">oc_switch_t</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
  <span class="token class-name">oc_resource_t</span> <span class="token operator">*</span>resource<span class="token punctuation">;</span>
  bool state<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token class-name">oc_switch_t</span><span class="token punctuation">;</span>
<span class="token function">OC_MEMB</span><span class="token punctuation">(</span>switch_s<span class="token punctuation">,</span> <span class="token class-name">oc_switch_t</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">OC_LIST</span><span class="token punctuation">(</span>switches<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token class-name">oc_resource_t</span><span class="token operator">*</span>
<span class="token function">new_switch_instance</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> href<span class="token punctuation">,</span> <span class="token class-name">oc_string_array_t</span> <span class="token operator">*</span>types<span class="token punctuation">,</span>
                    <span class="token class-name">oc_resource_properties_t</span> bm<span class="token punctuation">,</span> <span class="token class-name">oc_interface_mask_t</span> iface_mask<span class="token punctuation">,</span>
                    <span class="token class-name">size_t</span> device<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name">oc_switch_t</span> <span class="token operator">*</span>cswitch <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">oc_switch_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">oc_memb_alloc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>switch_s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cswitch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cswitch<span class="token operator">-&gt;</span>resource <span class="token operator">=</span> <span class="token function">oc_new_resource</span><span class="token punctuation">(</span>
      <span class="token constant">NULL</span><span class="token punctuation">,</span> href<span class="token punctuation">,</span> <span class="token function">oc_string_array_get_allocated_size</span><span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">)</span><span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">size_t</span> i<span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">oc_string_array_get_allocated_size</span><span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>rt <span class="token operator">=</span> <span class="token function">oc_string_array_get_item</span><span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">oc_resource_bind_resource_type</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">oc_resource_bind_resource_interface</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> iface_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
      cswitch<span class="token operator">-&gt;</span>resource<span class="token operator">-&gt;</span>properties <span class="token operator">=</span> bm<span class="token punctuation">;</span>
      <span class="token function">oc_resource_set_default_interface</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> OC_IF_A<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">oc_resource_set_request_handler</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> OC_GET<span class="token punctuation">,</span> get_cswitch<span class="token punctuation">,</span>
                                      cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">oc_resource_set_request_handler</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> OC_DELETE<span class="token punctuation">,</span> delete_cswitch<span class="token punctuation">,</span>
                                      cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">oc_resource_set_request_handler</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> OC_POST<span class="token punctuation">,</span> post_cswitch<span class="token punctuation">,</span>
                                      cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">oc_resource_set_properties_cbs</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> get_switch_properties<span class="token punctuation">,</span>
                                     cswitch<span class="token punctuation">,</span> set_switch_properties<span class="token punctuation">,</span> cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">oc_add_resource</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">oc_set_delayed_callback</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> register_to_cloud<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">oc_list_insert</span><span class="token punctuation">(</span>switches<span class="token punctuation">,</span> prev<span class="token punctuation">,</span> cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">oc_memb_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>switch_s<span class="token punctuation">,</span> cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">void</span>
<span class="token function">free_switch_instance</span><span class="token punctuation">(</span><span class="token class-name">oc_resource_t</span> <span class="token operator">*</span>resource<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token class-name">oc_switch_t</span> <span class="token operator">*</span>cswitch <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">oc_switch_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">oc_list_head</span><span class="token punctuation">(</span>switches<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>cswitch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource <span class="token operator">==</span> resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">oc_delete_resource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">oc_list_remove</span><span class="token punctuation">(</span>switches<span class="token punctuation">,</span> cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">oc_memb_free</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>switch_s<span class="token punctuation">,</span> cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cswitch <span class="token operator">=</span> <span class="token function">oc_list_item_next</span><span class="token punctuation">(</span>cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="compile-and-link"><a href="#compile-and-link" class="header-anchor">#</a> Compile and link</h4> <p>To enable create operation in iotivity-light library compile with CREATE=1 option.</p> <div class="language-make extra-class"><pre class="language-text"><code>make cloud_server CLOUD=1 SECURE=0 CREATE=1
</code></pre></div><h4 id="create-a-resource"><a href="#create-a-resource" class="header-anchor">#</a> Create a resource</h4> <p>When you have a cloud backend and cloud_server binary running. You can use cloud client to create a resource.</p> <h4 id="using-go-grpc-client"><a href="#using-go-grpc-client" class="header-anchor">#</a> Using go grpc client</h4> <p>Go <a href="https://github.com/plgd-dev/cloud/tree/master/bundle/client/grpc" target="_blank" rel="noopener noreferrer">grpc client<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a simple tool that supports several useful commands we can combine to create a resource.</p> <ol><li>Use the get command to identify the collection device</li></ol> <p>The get command retrieves data of all available devices. To correctly call the create command the device id and href properties are necessary. In the output find the item with type &quot;oic.wk.col&quot;.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>// retrieves all resources of all devices
./grpc -get
</code></pre></div><p>Output:</p> <div class="language-json extra-class"><pre class="language-json"><code>...
<span class="token punctuation">{</span>
    <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;content_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.ocf+cbor&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;n/8=&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;resource_id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;device_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2b9ed3ed-ddf3-4c9c-4d21-9ec1f6ba6b03&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/switches&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;oic.wk.col&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
...
</code></pre></div><ol start="2"><li>Create a binary switch resource in the collection</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>./grpc -create -deviceid 2b9ed3ed-ddf3-4c9c-4d21-9ec1f6ba6b03 -href /switches <span class="token operator">&lt;&lt;</span><span class="token string">EOF
{
    &quot;rt&quot;: [
        &quot;oic.r.switch.binary&quot;
    ],
    &quot;if&quot;: [
        &quot;oic.if.a&quot;,
        &quot;oic.if.baseline&quot;
    ],
    &quot;rep&quot;: {
        &quot;value&quot;: false
    },
    &quot;p&quot;: {
        &quot;bm&quot;: 3
    }
}
EOF</span>
</code></pre></div><p>The command creates a binary switch (&quot;oic.r.switch.binary&quot;), which supports actuator interface (&quot;oic.if.a&quot;) and has two possible states (&quot;value&quot;: true/false). The switch is set to be discoverable and observable (&quot;bm&quot;: 3; mask value 3 equals <code>OC_DISCOVERABLE | OC_OBSERVABLE</code>).</p> <ol start="3"><li>Use the get command again to examine the newly created switch</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>// retrieves all resources of all devices
./grpc -get
</code></pre></div><p>Output:</p> <div class="language-json extra-class"><pre class="language-json"><code>...
<span class="token punctuation">{</span>
    <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;content_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.ocf+cbor&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v2V2YWx1ZfT/&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;resource_id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;device_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2b9ed3ed-ddf3-4c9c-4d21-9ec1f6ba6b03&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/4rLN4BlwJmFmbbMJblChB2kyT2zJEP&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;oic.r.switch.binary&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
...
</code></pre></div><h2 id="deleting-resources"><a href="#deleting-resources" class="header-anchor">#</a> Deleting Resources</h2> <h3 id="description-2"><a href="#description-2" class="header-anchor">#</a> Description</h3> <p>Device with collection resource allows to delete dynamically created resource. To delete resource you need to set delete handler during creating resource.</p> <h3 id="guide-2"><a href="#guide-2" class="header-anchor">#</a> Guide</h3> <p>To develop your own device you can examine the example in <a href="https://github.com/iotivity/iotivity-lite/blob/master/apps/cloud_server.c" target="_blank" rel="noopener noreferrer">cloud_server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Lets examine the example to identify the necessary steps that allow a device to delete dynamically created resource at a collection.</p> <h4 id="set-delete-handler-at-constructor"><a href="#set-delete-handler-at-constructor" class="header-anchor">#</a> Set delete handler at constructor</h4> <div class="language-C extra-class"><pre class="language-c"><code><span class="token comment">// delete handler of switch</span>
<span class="token keyword">static</span> <span class="token keyword">void</span>
<span class="token function">delete_cswitch</span><span class="token punctuation">(</span><span class="token class-name">oc_request_t</span> <span class="token operator">*</span>request<span class="token punctuation">,</span> <span class="token class-name">oc_interface_mask_t</span> iface_mask<span class="token punctuation">,</span>
            <span class="token keyword">void</span> <span class="token operator">*</span>user_data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token function">OC_DBG</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> <span class="token constant">__func__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>request<span class="token punctuation">;</span>
  <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>iface_mask<span class="token punctuation">;</span>
  <span class="token class-name">oc_switch_t</span> <span class="token operator">*</span>cswitch <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">oc_switch_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>user_data<span class="token punctuation">;</span>

  <span class="token comment">// cleanup resource data</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

  <span class="token comment">// we cannot delete resource immediately via oc_delete_resource because</span>
  <span class="token comment">// it is used during invocation delete handler. So we plan deleting via oc_delayed_delete_resource call.</span>
  <span class="token function">oc_delayed_delete_resource</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-C extra-class"><pre class="language-c"><code><span class="token keyword">static</span> <span class="token class-name">oc_resource_t</span><span class="token operator">*</span>
<span class="token function">new_switch_instance</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> href<span class="token punctuation">,</span> <span class="token class-name">oc_string_array_t</span> <span class="token operator">*</span>types<span class="token punctuation">,</span>
                    <span class="token class-name">oc_resource_properties_t</span> bm<span class="token punctuation">,</span> <span class="token class-name">oc_interface_mask_t</span> iface_mask<span class="token punctuation">,</span>
                    <span class="token class-name">size_t</span> device<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
      <span class="token function">oc_resource_set_request_handler</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> OC_GET<span class="token punctuation">,</span> get_cswitch<span class="token punctuation">,</span>
                                      cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// set delete handler to the created resource</span>
      <span class="token function">oc_resource_set_request_handler</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> OC_DELETE<span class="token punctuation">,</span> delete_cswitch<span class="token punctuation">,</span>
                                      cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">oc_resource_set_request_handler</span><span class="token punctuation">(</span>cswitch<span class="token operator">-&gt;</span>resource<span class="token punctuation">,</span> OC_POST<span class="token punctuation">,</span> post_cswitch<span class="token punctuation">,</span>
                                      cswitch<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="using-go-grpc-client-2"><a href="#using-go-grpc-client-2" class="header-anchor">#</a> Using go grpc client</h4> <p>Delete a created binary switch resource from the collection.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./grpc -delete -deviceid 2b9ed3ed-ddf3-4c9c-4d21-9ec1f6ba6b03 -href /4rLN4BlwJmFmbbMJblChB2kyT2zJEP
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/plgd-dev/cloud/edit/v2/docs/guide/developing/resources.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/7/2021, 7:02:42 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/deployment/cloud2cloud-gateway.html" class="prev">
        Cloud2Cloud Gateway
      </a></span> <span class="next"><a href="/guide/developing/dashboard.html">
        PLGD Dashboard
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.046fd415.js" defer></script><script src="/assets/js/2.7dba4fe4.js" defer></script><script src="/assets/js/26.de82e42f.js" defer></script>
  </body>
</html>
